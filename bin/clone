#!/usr/bin/env node
const readline = require('readline');
const fs = require('fs');

const {clone} = require('../index');

// 使用方法：
// 1. clone url
// 2. clone --file urlfile.txt

let argv = process.argv;

if (argv[2] === '--file') {
    if (argv[3]) {
        try {
            let inputStream = fs.createReadStream(argv[3]);
            inputStream.on('error', err => {
                console.log(`读取文件 ${argv[3]} 失败，请检查文件路径是否正确`);
                process.exit();
            });
            let lineReader = readline.createInterface({input: inputStream});
            lineReader.on('line', (url) => {
                console.log('clone url: ' + url);
                clone(url);
            })
        } catch (e) {
            console.log(`读取 ${argv[3]} 失败，请检查路径是否正确`)
        }
    } else {
        console.log('请指定输入文件路径');
        process.exit();
    }
} else if (argv[2]) {
    console.log('clone url: ' + argv[2]);
    clone(argv[2]);
} else {
    console.log('参数有误，请按照：clone url 或者 clone --file urlfile.txt 提供参数');
    process.exit();
}